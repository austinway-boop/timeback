<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaLearn - Assign Tests</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" as="style">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" as="style">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preload" href="/css/style.css?v=9" as="style">
    <link rel="stylesheet" href="/css/style.css?v=9">
    <link rel="stylesheet" href="/css/admin/assign-tests.css?v=7">
</head>
<body data-view="admin" data-active="assign-tests">

<div class="layout">
    <nav class="sidebar" id="sidebar"></nav>
    <main class="main-content">

        <!-- Hero Banner -->
        <div class="hero-banner">
            <img src="https://images.unsplash.com/photo-1513258496099-48168024aec0?w=1200&h=300&fit=crop" alt="">
            <div class="hero-overlay">
                <div>
                    <h1><i class="fa-solid fa-clipboard-check" style="margin-right:10px;"></i>Assign Tests</h1>
                    <p>Search for a student and assign mastery tests by subject and grade level.</p>
                </div>
            </div>
        </div>

        <!-- Student Search -->
        <div class="search-wrap">
            <i class="fa-solid fa-magnifying-glass search-icon"></i>
            <input type="text" id="student-search" placeholder="Search for a student by name or email...">
            <div class="search-dropdown" id="search-dropdown"></div>
        </div>

        <!-- Two-Column Panels (hidden until a student is selected) -->
        <div id="panels" style="display:none;">
            <div id="assign-feedback"></div>
            <div class="two-col">
                <!-- Available Tests -->
                <div class="panel-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fa-solid fa-clipboard-list"></i>Available Tests</h2>
                        <select class="filter-select" id="subject-filter" onchange="renderTests()">
                            <option value="all">All Subjects</option>
                        </select>
                    </div>
                    <div class="panel-body" id="tests-list">
                        <div class="empty-state"><i class="fa-solid fa-clipboard-list"></i><p>Select a student to see available tests.</p></div>
                    </div>
                </div>

                <!-- Pending / Existing Assignments -->
                <div class="panel-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fa-solid fa-clock"></i>Student's Tests</h2>
                    </div>
                    <div class="panel-body" id="pending-tests">
                        <div class="empty-state"><i class="fa-solid fa-check-circle"></i><p>No test assignments yet.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ══════════════════════════════════════════════════════════
             Course Diagnostics — Generate & Assign AI-built assessments
             ══════════════════════════════════════════════════════════ -->
        <div class="diag-section" id="diag-section">
            <div class="diag-header">
                <h2><i class="fa-solid fa-stethoscope"></i> Course Diagnostics</h2>
                <p>Generate AI-powered mastery assessments from course learning trees.</p>
            </div>

            <!-- Course Selector -->
            <div class="diag-row">
                <div class="panel-card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fa-solid fa-book-open"></i>Select Course</h2>
                        <button class="diag-btn refresh" onclick="diagLoadCourses()" title="Refresh courses">
                            <i class="fa-solid fa-arrows-rotate"></i>
                        </button>
                    </div>
                    <div class="panel-body" style="max-height:none;">
                        <div class="diag-course-search-wrap">
                            <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            <input type="text" id="diag-course-search" placeholder="Search courses with learning trees..." oninput="diagFilterCourses()">
                        </div>
                        <div id="diag-courses-list">
                            <div class="empty-state"><i class="fa-solid fa-spinner fa-spin" style="opacity:0.5;"></i><p>Loading courses...</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generation & Preview Panel (hidden until course selected) -->
            <div id="diag-gen-panel" style="display:none;">
                <div class="diag-row">
                    <div class="panel-card">
                        <div class="card-header">
                            <h2 class="card-title"><i class="fa-solid fa-wand-magic-sparkles"></i>Diagnostic for: <span id="diag-course-name"></span></h2>
                        </div>
                        <div class="panel-body" style="max-height:none;">
                            <div id="diag-unit-select">
                                <!-- Unit checkboxes rendered by JS -->
                            </div>
                            <div id="diag-status-area">
                                <!-- Dynamic content: generate button, progress, preview -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assignment Panel (hidden until diagnostic exists) -->
            <div id="diag-assign-panel" style="display:none;">
                <div class="diag-row">
                    <div class="two-col">
                        <div class="panel-card">
                            <div class="card-header">
                                <h2 class="card-title"><i class="fa-solid fa-user-plus"></i>Assign Diagnostic</h2>
                            </div>
                            <div class="panel-body" style="max-height:none;">
                                <div class="diag-course-search-wrap">
                                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                                    <input type="text" id="diag-student-search" placeholder="Search for a student by name or email..." autocomplete="off">
                                    <div class="search-dropdown" id="diag-student-dropdown"></div>
                                </div>
                                <div id="diag-assign-feedback"></div>
                                <div id="diag-selected-student" style="display:none;"></div>
                            </div>
                        </div>
                        <div class="panel-card">
                            <div class="card-header">
                                <h2 class="card-title"><i class="fa-solid fa-list-check"></i>Assigned Students</h2>
                            </div>
                            <div class="panel-body" id="diag-assigned-list">
                                <div class="empty-state"><i class="fa-solid fa-clipboard-list"></i><p>No students assigned yet.</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
</div>

<script src="/js/auth-guard.js?v=3"></script>
<script src="/js/layout.js?v=20"></script>
<script src="/js/notifications.js?v=7"></script>
<script src="/js/app.js?v=7"></script>
<script src="/js/admin/assign-tests.js?v=9"></script>
</body>
</html>
